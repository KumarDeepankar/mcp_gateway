INFO:     Will watch for changes in these directories: ['/Users/deepankar/Documents/mcp_gateway']
INFO:     Uvicorn running on http://127.0.0.1:8021 (Press CTRL+C to quit)
INFO:     Started reloader process [10632] using WatchFiles
JWT_SECRET not found in environment. Generating random secret. This should only happen in development.
2025-10-11 19:52:36,097 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:52:36,097 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
Process SpawnProcess-1:
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "uvloop/loop.pyx", line 1517, in uvloop.loop.Loop.run_until_complete
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 70, in serve
    await self._serve(sockets)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 77, in _serve
    config.load()
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/config.py", line 435, in load
    self.loaded_app = import_from_string(self.app)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 992, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/__init__.py", line 14, in <module>
    from .main import app, logger, mcp_gateway
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/main.py", line 92, in <module>
    app.mount("/static", StaticFiles(directory="static"), name="static")
  File "/opt/homebrew/lib/python3.10/site-packages/starlette/staticfiles.py", line 56, in __init__
    raise RuntimeError(f"Directory '{directory}' does not exist")
RuntimeError: Directory 'static' does not exist
WARNING:  WatchFiles detected changes in 'tools_gateway/main.py'. Reloading...
JWT_SECRET not found in environment. Generating random secret. This should only happen in development.
2025-10-11 19:53:36,360 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:53:36,360 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [10965]
INFO:     Waiting for application startup.
2025-10-11 19:53:36,370 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 19:53:36,370 - tools_gateway.mcp_storage - INFO - Loaded 0 MCP server configurations from database
2025-10-11 19:53:36,370 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:53:36,370 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:53:36,370 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:53:36,370 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 19:53:36,370 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tools_gateway/main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 19:53:43,344 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 19:53:43,345 - tools_gateway.services - INFO - Stopped connection health monitoring
INFO:     Application shutdown complete.
INFO:     Finished server process [10965]
JWT_SECRET not found in environment. Generating random secret. This should only happen in development.
2025-10-11 19:53:43,746 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:53:43,746 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [10994]
INFO:     Waiting for application startup.
2025-10-11 19:53:43,756 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 19:53:43,757 - tools_gateway.mcp_storage - INFO - Loaded 0 MCP server configurations from database
2025-10-11 19:53:43,757 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:53:43,757 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:53:43,757 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:53:43,757 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 19:53:43,757 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
INFO:     127.0.0.1:55861 - "GET /health HTTP/1.1" 404 Not Found
2025-10-11 19:53:57,855 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 19:53:57,861 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 19:53:57,862 - tools_gateway.database - INFO - Only 1 audit logs exist, no cleanup needed (keeping last 5)
2025-10-11 19:53:57,862 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:55864 - "POST /auth/login/local HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'tools_gateway/auth.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 19:54:31,241 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 19:54:31,241 - tools_gateway.services - INFO - Stopped connection health monitoring
INFO:     Application shutdown complete.
INFO:     Finished server process [10994]
2025-10-11 19:54:31,548 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:54:31,548 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [11162]
INFO:     Waiting for application startup.
2025-10-11 19:54:31,557 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 19:54:31,557 - tools_gateway.mcp_storage - INFO - Loaded 0 MCP server configurations from database
2025-10-11 19:54:31,557 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:54:31,557 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:54:31,557 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:54:31,557 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 19:54:31,557 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
2025-10-11 19:54:43,597 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 19:54:43,600 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 19:54:43,600 - tools_gateway.database - INFO - Only 2 audit logs exist, no cleanup needed (keeping last 5)
2025-10-11 19:54:43,600 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:55968 - "POST /auth/login/local HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'agentic_search/debug_auth.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 19:55:22,984 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 19:55:22,984 - tools_gateway.services - INFO - Stopped connection health monitoring
INFO:     Application shutdown complete.
INFO:     Finished server process [11162]
2025-10-11 19:55:23,324 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:55:23,324 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [11363]
INFO:     Waiting for application startup.
2025-10-11 19:55:23,334 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 19:55:23,334 - tools_gateway.mcp_storage - INFO - Loaded 0 MCP server configurations from database
2025-10-11 19:55:23,334 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:55:23,334 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:55:23,334 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:55:23,334 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 19:55:23,334 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
2025-10-11 19:56:23,337 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:56:23,337 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '0.0.0.0', '127.0.0.1'}
2025-10-11 19:56:23,337 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:56:23,337 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 0fb6dca6-dd16-4498-942f-d20be9bb820d
INFO:     127.0.0.1:56200 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 19:56:23,338 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:56:23,338 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '0.0.0.0', '127.0.0.1'}
2025-10-11 19:56:23,338 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:56:23,338 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56200 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 19:56:23,339 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:56:23,339 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '0.0.0.0', '127.0.0.1'}
2025-10-11 19:56:23,339 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:56:23,339 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 19:56:23,339 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:56:23,339 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:56:23,339 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:56:23,340 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 19:56:23,340 - tools_gateway.routers.mcp_router - ERROR - Critical error in POST endpoint: name 'get_current_user' is not defined
Traceback (most recent call last):
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/routers/mcp_router.py", line 254, in mcp_post_endpoint
    user = get_current_user(request)
NameError: name 'get_current_user' is not defined
INFO:     127.0.0.1:56200 - "POST /mcp HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'tools_gateway/routers/mcp_router.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 19:56:55,983 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 19:56:55,983 - tools_gateway.services - INFO - Stopped connection health monitoring
INFO:     Application shutdown complete.
INFO:     Finished server process [11363]
Process SpawnProcess-6:
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "uvloop/loop.pyx", line 1517, in uvloop.loop.Loop.run_until_complete
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 70, in serve
    await self._serve(sockets)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/server.py", line 77, in _serve
    config.load()
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/config.py", line 435, in load
    self.loaded_app = import_from_string(self.app)
  File "/opt/homebrew/lib/python3.10/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
  File "/opt/homebrew/Cellar/python@3.10/3.10.17/Frameworks/Python.framework/Versions/3.10/lib/python3.10/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 992, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "<frozen importlib._bootstrap>", line 1050, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 883, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/__init__.py", line 14, in <module>
    from .main import app, logger, mcp_gateway
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/main.py", line 31, in <module>
    from .routers import (
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/routers/__init__.py", line 10, in <module>
    from .mcp_router import router as mcp_router
  File "/Users/deepankar/Documents/mcp_gateway/tools_gateway/routers/mcp_router.py", line 30, in <module>
    from tools_gateway.rbac import get_current_user, rbac_manager
ImportError: cannot import name 'get_current_user' from 'tools_gateway.rbac' (/Users/deepankar/Documents/mcp_gateway/tools_gateway/rbac.py)
WARNING:  WatchFiles detected changes in 'tools_gateway/rbac.py'. Reloading...
2025-10-11 19:58:42,100 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 19:58:42,100 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [12255]
INFO:     Waiting for application startup.
2025-10-11 19:58:42,110 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 19:58:42,110 - tools_gateway.mcp_storage - INFO - Loaded 0 MCP server configurations from database
2025-10-11 19:58:42,110 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:58:42,110 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:58:42,110 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:58:42,110 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 19:58:42,110 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
2025-10-11 19:58:42,111 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:58:42,111 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 19:58:42,111 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:58:42,111 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 4330dcea-7046-4c5f-bb92-c651bfeaada8
INFO:     127.0.0.1:56332 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 19:58:57,233 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:58:57,233 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 19:58:57,233 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:58:57,234 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 7db6bce1-fee7-44f5-b8ac-91a3eecd7270
INFO:     127.0.0.1:56455 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 19:58:57,237 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:58:57,237 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 19:58:57,237 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:58:57,237 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56455 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 19:58:57,239 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 19:58:57,239 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 19:58:57,239 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 19:58:57,239 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 19:58:57,239 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 19:58:57,239 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 19:58:57,239 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 19:58:57,239 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 19:58:57,243 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 19:58:57,243 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 0 of 0 tools for user admin
INFO:     127.0.0.1:56455 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:01:13,456 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:01:13,456 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'cache-control': 'max-age=0', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'sec-fetch-site': 'none', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667; Pycharm-7c76b434=0daae8ca-c8a9-4ebc-94e7-ad5b5a87c661', 'if-none-match': 'b59070789ca14b40837d4d6d265f531b', 'if-modified-since': 'Sat, 11 Oct 2025 18:54:12 GMT'}
INFO:     127.0.0.1:56490 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:56490 - "GET /static/css/mcp-portal.css?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56491 - "GET /static/css/oauth-forms.css?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56496 - "GET /static/js/admin-security.js?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56495 - "GET /static/js/mcp-portal.js?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56497 - "GET /static/js/admin-ad-fetched.js?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56491 - "GET /static/js/auth.js?v=9 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56491 - "POST /manage HTTP/1.1" 200 OK
2025-10-11 20:01:13,492 - tools_gateway.auth - ERROR - Token verification failed: Signature verification failed.
INFO:     127.0.0.1:56497 - "GET /auth/user HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:56495 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:01:13,493 - tools_gateway.auth - ERROR - Token verification failed: Signature verification failed.
INFO:     127.0.0.1:56491 - "GET /auth/user HTTP/1.1" 401 Unauthorized
INFO:     127.0.0.1:56491 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56495 - "GET /static/login.html HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:56491 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:01:23,293 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:01:23,294 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:01:23,296 - tools_gateway.database - INFO - Only 3 audit logs exist, no cleanup needed (keeping last 5)
2025-10-11 20:01:23,296 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:56499 - "POST /auth/login/local HTTP/1.1" 200 OK
INFO:     127.0.0.1:56499 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:56501 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:56503 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56499 - "GET /auth/user HTTP/1.1" 200 OK
2025-10-11 20:01:27,242 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:01:27,243 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'cache-control': 'max-age=0', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'sec-fetch-site': 'same-origin', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'referer': 'http://localhost:8021/static/login.html', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667; Pycharm-7c76b434=0daae8ca-c8a9-4ebc-94e7-ad5b5a87c661', 'if-none-match': '"b59070789ca14b40837d4d6d265f531b"', 'if-modified-since': 'Sat, 11 Oct 2025 18:54:12 GMT'}
INFO:     127.0.0.1:56499 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:56499 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:56503 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:56501 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56499 - "GET /auth/user HTTP/1.1" 200 OK
2025-10-11 20:01:28,224 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,224 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,225 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,225 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 56db0805-7fbc-4d11-9859-ead1c08461c3
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:01:28,228 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,229 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,229 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,229 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:01:28,233 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,233 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,233 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,233 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:01:28,233 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:01:28,233 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 20:01:28,233 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 20:01:28,233 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 20:01:28,234 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:01:28,893 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,894 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,894 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,894 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 85370829-2bb3-4d89-a093-2a1315defc29
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:01:28,900 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,900 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,900 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,900 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:01:28,904 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:01:28,904 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:01:28,904 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:01:28,904 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:01:28,904 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:01:28,904 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 20:01:28,904 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 20:01:28,905 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 20:01:28,905 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:56499 - "POST /mcp HTTP/1.1" 200 OK
INFO:     127.0.0.1:56499 - "GET /config HTTP/1.1" 200 OK
INFO:     127.0.0.1:56503 - "GET /health/servers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56503 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:02:15,475 - tools_gateway.routers.admin_oauth_router - INFO - First-time OAuth provider setup - allowing unauthenticated access
2025-10-11 20:02:15,476 - tools_gateway.database - INFO - Saved OAuth provider: google
2025-10-11 20:02:15,477 - tools_gateway.auth - INFO - Added OAuth provider: google
2025-10-11 20:02:15,478 - tools_gateway.database - INFO - Only 4 audit logs exist, no cleanup needed (keeping last 5)
2025-10-11 20:02:15,478 - tools_gateway.audit - INFO - AUDIT: oauth.provider.added - user:system - N/A
INFO:     127.0.0.1:56505 - "POST /admin/oauth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56505 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56508 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:02:24,318 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:02:24,320 - tools_gateway.database - INFO - Only 5 audit logs exist, no cleanup needed (keeping last 5)
2025-10-11 20:02:24,320 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:56508 - "POST /auth/login?provider_id=google HTTP/1.1" 200 OK
2025-10-11 20:02:32,990 - tools_gateway.routers.auth_router - INFO - OAuth callback received - code: 4/0AVGzR1CI7ft8W8hYD..., state: llSHs1vSqP9Wl97xR65s...
2025-10-11 20:02:33,260 - tools_gateway.auth - INFO - Successfully exchanged code for token: google
2025-10-11 20:02:33,261 - tools_gateway.routers.auth_router - INFO - Token exchange successful for provider: google
2025-10-11 20:02:33,432 - tools_gateway.auth - INFO - Retrieved user info for deepankar32@gmail.com from google
2025-10-11 20:02:33,433 - tools_gateway.routers.auth_router - INFO - User info retrieved: email=deepankar32@gmail.com, name=Kumar Deepankar
2025-10-11 20:02:33,434 - tools_gateway.database - INFO - Saved user: user_fU6IZAPwaNLZbA1H
2025-10-11 20:02:33,436 - tools_gateway.database - INFO - Assigned role user to user user_fU6IZAPwaNLZbA1H
2025-10-11 20:02:33,437 - tools_gateway.rbac - INFO - Created user: deepankar32@gmail.com (user_fU6IZAPwaNLZbA1H)
2025-10-11 20:02:33,437 - tools_gateway.routers.auth_router - INFO - User created/retrieved: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:02:33,437 - tools_gateway.auth - INFO - Created access token for deepankar32@gmail.com
2025-10-11 20:02:33,438 - tools_gateway.routers.auth_router - INFO - JWT token created for user: deepankar32@gmail.com
2025-10-11 20:02:33,439 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:02:33,440 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:deepankar32@gmail.com - N/A
2025-10-11 20:02:33,440 - tools_gateway.routers.auth_router - INFO - Redirecting to: /?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzd...
INFO:     127.0.0.1:56509 - "GET /auth/callback?state=llSHs1vSqP9Wl97xR65sLQ2t1NP8VsAeJLqxe8WE0Pc&code=4%2F0AVGzR1CI7ft8W8hYDyFAb_37gJUsXxQPVfY1zqGWBmanItNBaqAWcHrFDRRoxgI3B68eog&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+openid&authuser=0&prompt=consent HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:02:33,446 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:02:33,446 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'x-browser-channel': 'stable', 'x-browser-year': '2025', 'x-browser-validation': 'qSH0RgPhYS+tEktJTy2ahvLDO9s=', 'x-browser-copyright': 'Copyright 2025 Google LLC. All rights reserved.', 'sec-fetch-site': 'cross-site', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'referer': 'https://accounts.google.com/', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667'}
INFO:     127.0.0.1:56509 - "GET /?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMTI5MTgxMDgxMzc2NzgyMDYwMzMiLCJlbWFpbCI6ImRlZXBhbmthcjMyQGdtYWlsLmNvbSIsIm5hbWUiOiJLdW1hciBEZWVwYW5rYXIiLCJwcm92aWRlciI6Imdvb2dsZSIsImV4cCI6MTc2MDI2Njk1MywiaWF0IjoxNzYwMjM4MTUzLCJ0eXBlIjoiYWNjZXNzIn0.TxecM-zL6nG5WtFPax0-Ks7Vhao-kSe-XGtaR5lox-Y HTTP/1.1" 200 OK
INFO:     127.0.0.1:56509 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:56509 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:56516 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56509 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:56509 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:02:40,063 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=user:manage
2025-10-11 20:02:40,064 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:02:40,064 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:02:40,064 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:02:40,064 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:02:40,064 - tools_gateway.rbac - INFO - ⚠️  Permission user:manage NOT in role user
2025-10-11 20:02:40,064 - tools_gateway.rbac - WARNING - ❌ Permission user:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
INFO:     127.0.0.1:56509 - "GET /admin/ad/config HTTP/1.1" 403 Forbidden
2025-10-11 20:02:40,066 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=user:view
2025-10-11 20:02:40,067 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:02:40,067 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:02:40,067 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:02:40,067 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:02:40,067 - tools_gateway.rbac - INFO - ⚠️  Permission user:view NOT in role user
2025-10-11 20:02:40,067 - tools_gateway.rbac - WARNING - ❌ Permission user:view NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
INFO:     127.0.0.1:56518 - "GET /admin/ad/group-mappings HTTP/1.1" 403 Forbidden
2025-10-11 20:02:40,068 - tools_gateway.routers.admin_users_router - INFO - 🔍 /admin/users endpoint - Authorization header present: True
2025-10-11 20:02:40,068 - tools_gateway.routers.admin_users_router - INFO - 🔍 Token payload: {'sub': '112918108137678206033', 'email': 'deepankar32@gmail.com', 'name': 'Kumar Deepankar', 'provider': 'google', 'exp': 1760266953, 'iat': 1760238153, 'type': 'access'}
2025-10-11 20:02:40,069 - tools_gateway.routers.admin_users_router - INFO - 🔍 User retrieved from email 'deepankar32@gmail.com': True
2025-10-11 20:02:40,069 - tools_gateway.routers.admin_users_router - INFO - 🔍 User details: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=user:view
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:02:40,069 - tools_gateway.rbac - INFO - ⚠️  Permission user:view NOT in role user
2025-10-11 20:02:40,069 - tools_gateway.rbac - WARNING - ❌ Permission user:view NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:02:40,069 - tools_gateway.routers.admin_users_router - WARNING - ❌ Permission check failed for user: user_fU6IZAPwaNLZbA1H
INFO:     127.0.0.1:56521 - "GET /admin/users HTTP/1.1" 403 Forbidden
2025-10-11 20:02:40,070 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=role:view
2025-10-11 20:02:40,070 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:02:40,070 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:02:40,070 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:02:40,071 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:02:40,071 - tools_gateway.rbac - INFO - ⚠️  Permission role:view NOT in role user
2025-10-11 20:02:40,071 - tools_gateway.rbac - WARNING - ❌ Permission role:view NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
INFO:     127.0.0.1:56522 - "GET /admin/roles HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:56522 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:03:13,198 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:03:13,198 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:03:13,199 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:03:13,199 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:56529 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:06:15,274 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:06:15,274 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:06:15,275 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:06:15,276 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:56556 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:06:15,612 - tools_gateway.routers.auth_router - INFO - OAuth callback-redirect received - state: q26mYLA2ZDCtzlAqEXYu...
2025-10-11 20:06:15,786 - tools_gateway.auth - INFO - Successfully exchanged code for token: google
2025-10-11 20:06:15,787 - tools_gateway.routers.auth_router - INFO - Token exchange successful for provider: google
2025-10-11 20:06:15,969 - tools_gateway.auth - INFO - Retrieved user info for deepankar32@gmail.com from google
2025-10-11 20:06:15,970 - tools_gateway.routers.auth_router - INFO - User info retrieved: email=deepankar32@gmail.com, name=Kumar Deepankar
2025-10-11 20:06:15,972 - tools_gateway.routers.auth_router - INFO - User created/retrieved: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:06:15,972 - tools_gateway.auth - INFO - Created access token for deepankar32@gmail.com
2025-10-11 20:06:15,972 - tools_gateway.routers.auth_router - INFO - JWT token created for user: deepankar32@gmail.com
2025-10-11 20:06:15,974 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:06:15,975 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:deepankar32@gmail.com - N/A
2025-10-11 20:06:15,975 - tools_gateway.routers.auth_router - INFO - Redirecting to external service: http://localhost:8023/auth/callback...
INFO:     127.0.0.1:56556 - "GET /auth/callback-redirect?state=q26mYLA2ZDCtzlAqEXYuxXPaanijUy7zNI_T7XtPU6s&code=4%2F0AVGzR1A0EHuwX3FfVbrF0oEWassvsR4l7DPAu92QR5GcNGw1dvFenm6UMPNSzaQheborLw&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+openid&authuser=0&prompt=none HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:06:16,108 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:16,108 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:16,108 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:16,108 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 2c7f9032-ee1e-49b2-9b83-755bfdda152e
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:06:16,111 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:16,111 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:16,111 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:16,112 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:06:16,115 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:16,115 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:16,115 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:16,115 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:06:16,115 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:06:16,115 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 20:06:16,115 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 20:06:16,116 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 20:06:16,116 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:06:16,116 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 0 of 0 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:06:19,428 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:19,428 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:19,428 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:19,428 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 2fa74a6d-e5b3-4f3b-9073-cc094bbfb11b
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:06:19,432 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:19,432 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:19,432 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:19,432 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:06:19,435 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:06:19,435 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:06:19,435 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:06:19,436 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:06:19,436 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:06:19,436 - tools_gateway.services - INFO - No servers in storage - starting with empty state
2025-10-11 20:06:19,436 - tools_gateway.services - INFO - No MCP servers configured. Tools discovery will be empty until servers are added via UI.
2025-10-11 20:06:19,436 - tools_gateway.services - INFO - Aggregated 0 tools from 0 servers
2025-10-11 20:06:19,436 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:06:19,436 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 0 of 0 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:56560 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:06:47,384 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:06:47,384 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:06:47,385 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:06:47,386 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:56562 - "POST /auth/login/local HTTP/1.1" 200 OK
INFO:     127.0.0.1:56562 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:56564 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:56566 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:56562 - "GET /auth/user HTTP/1.1" 200 OK
2025-10-11 20:07:05,471 - tools_gateway.mcp_storage - INFO - Successfully discovered MCP server: mcp-opensearch-server
2025-10-11 20:07:05,472 - tools_gateway.database - INFO - Saved MCP server: mcp_127_0_0_1_8001
2025-10-11 20:07:05,473 - tools_gateway.mcp_storage - INFO - Saved 1 MCP server configurations to database
2025-10-11 20:07:05,473 - tools_gateway.mcp_storage - INFO - Registered MCP server: mcp_127_0_0_1_8001
2025-10-11 20:07:05,473 - tools_gateway.mcp_storage - INFO - Successfully registered MCP server: mcp_127_0_0_1_8001
2025-10-11 20:07:05,475 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:07:05,475 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:07:05,487 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:07:05,492 - tools_gateway.services - DEBUG - Initialized session 6a692abc-b6a8-4650-ad2b-a649472278d8 with http://127.0.0.1:8001
2025-10-11 20:07:05,496 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:07:05,497 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
INFO:     127.0.0.1:56568 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:56568 - "POST /manage HTTP/1.1" 200 OK
2025-10-11 20:07:06,656 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:06,656 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:06,656 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:06,656 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session f6ab3b40-3817-45b0-9926-6a9a11988eae
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:07:06,661 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:06,661 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:06,661 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:06,661 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:07:06,669 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:06,669 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:06,669 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:06,669 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:07:06,672 - tools_gateway.services - DEBUG - Initialized session 243de1e9-3ef4-4dbe-8a48-ddc05053d487 with http://127.0.0.1:8001
2025-10-11 20:07:06,676 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:07:06,676 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:07:06,676 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:07:06,680 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:07:06,681 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:06,681 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:07:06,681 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:56568 - "GET /admin/roles HTTP/1.1" 200 OK
2025-10-11 20:07:07,399 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:07,399 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:07,399 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:07,399 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session b7c02237-5fa9-4a60-9ed3-9a490f108fb0
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:07:07,404 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:07,405 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:07,405 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:07,405 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:07:07,410 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:07,410 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:07,411 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:07,411 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:07:07,415 - tools_gateway.services - DEBUG - Initialized session 5aeca82a-8163-4758-80ec-744b10dcb233 with http://127.0.0.1:8001
2025-10-11 20:07:07,419 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:07:07,420 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:07:07,420 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:56568 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:07:13,430 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:13,430 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:13,430 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:13,430 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session cf4eceaa-afb6-4168-abd9-8892e96c75c8
INFO:     127.0.0.1:56574 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:07:13,434 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:13,434 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:13,434 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:13,434 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56574 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:07:13,438 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:07:13,438 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:07:13,438 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:07:13,438 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:07:13,441 - tools_gateway.services - DEBUG - Initialized session 890ed1d9-b6f8-496c-9acd-faf1016beea4 with http://127.0.0.1:8001
2025-10-11 20:07:13,443 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:07:13,443 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:07:13,444 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:07:13,444 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool search_stories
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,444 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:07:13,445 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool get_story
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:07:13,445 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool list_stories
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:07:13,445 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:07:13,446 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:07:13,446 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:07:13,446 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:07:13,446 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:07:13,446 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:07:13,446 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool count_stories
2025-10-11 20:07:13,446 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:56574 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:03,250 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:03,251 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:03,251 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:03,251 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session ef6f3c37-42a8-4713-a5b0-d3b8beca426c
INFO:     127.0.0.1:56601 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:03,253 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:03,253 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:03,253 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:03,253 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56601 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:09:03,256 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:03,256 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:03,256 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:03,256 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:09:03,259 - tools_gateway.services - DEBUG - Initialized session d66a9643-fc95-4dae-978b-773f3827fd59 with http://127.0.0.1:8001
2025-10-11 20:09:03,261 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:03,261 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:03,261 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:03,262 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool search_stories
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:03,262 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool get_story
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,262 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:03,263 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool list_stories
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:03,263 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:03,263 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool count_stories
2025-10-11 20:09:03,263 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:56601 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,547 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,548 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,548 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,548 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 8ed5dd46-4098-4cac-9efa-61b2a82951cc
INFO:     127.0.0.1:56612 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,548 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,548 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,548 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,549 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 359fa62b-e7b0-40e1-82a8-213e1d65dd21
INFO:     127.0.0.1:56613 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,549 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,550 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,550 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,550 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 54d01e15-0e67-4104-95cc-55482216cb24
INFO:     127.0.0.1:56614 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,551 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,551 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,551 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,552 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56612 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:09:09,556 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,556 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,556 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,556 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56613 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:09:09,557 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,557 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,557 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,557 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56614 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:09:09,558 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,558 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,558 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,558 - tools_gateway.routers.mcp_router - INFO - tools/call (get_story): Routing to server: http://127.0.0.1:8001
2025-10-11 20:09:09,558 - tools_gateway.routers.mcp_router - INFO - tools/call: Checking authorization for user deepankar32@gmail.com to execute get_story
2025-10-11 20:09:09,561 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,561 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,561 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,561 - tools_gateway.routers.mcp_router - INFO - tools/call (list_stories): Routing to server: http://127.0.0.1:8001
2025-10-11 20:09:09,561 - tools_gateway.routers.mcp_router - INFO - tools/call: Checking authorization for user deepankar32@gmail.com to execute list_stories
2025-10-11 20:09:09,562 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:09:09,562 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'localhost', '127.0.0.1', '0.0.0.0'}
2025-10-11 20:09:09,562 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:09:09,563 - tools_gateway.routers.mcp_router - INFO - tools/call (search_stories): Routing to server: http://127.0.0.1:8001
2025-10-11 20:09:09,563 - tools_gateway.routers.mcp_router - INFO - tools/call: Checking authorization for user deepankar32@gmail.com to execute search_stories
2025-10-11 20:09:09,564 - tools_gateway.services - DEBUG - Initialized session f288a1c6-d1d7-4f9c-89d9-82d5ea43979b with http://127.0.0.1:8001
2025-10-11 20:09:09,566 - tools_gateway.services - DEBUG - Initialized session 4e6714b9-a80d-4a60-a385-c932408df1ff with http://127.0.0.1:8001
2025-10-11 20:09:09,567 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,567 - tools_gateway.services - DEBUG - Initialized session b935a124-3683-40de-8e5e-b60c1d3dbf31 with http://127.0.0.1:8001
2025-10-11 20:09:09,568 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:09,568 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:09,569 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:09,569 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool get_story
2025-10-11 20:09:09,569 - tools_gateway.routers.mcp_router - INFO - User deepankar32@gmail.com authorized to execute tool get_story
2025-10-11 20:09:09,570 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:09:09,570 - tools_gateway.audit - INFO - AUDIT: authz.permission.granted - user:deepankar32@gmail.com - N/A
2025-10-11 20:09:09,571 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,571 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,571 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:09,572 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:09,572 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool list_stories
2025-10-11 20:09:09,572 - tools_gateway.routers.mcp_router - INFO - User deepankar32@gmail.com authorized to execute tool list_stories
2025-10-11 20:09:09,572 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:09:09,573 - tools_gateway.audit - INFO - AUDIT: authz.permission.granted - user:deepankar32@gmail.com - N/A
2025-10-11 20:09:09,573 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,573 - tools_gateway.services - DEBUG - Initialized session 9d3c3a34-0c3b-4563-be78-19a97b189aed with http://127.0.0.1:8001
2025-10-11 20:09:09,574 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:09:09,574 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:09:09,574 - tools_gateway.rbac - INFO - Role user has no tool restrictions - allowing tool search_stories
2025-10-11 20:09:09,574 - tools_gateway.routers.mcp_router - INFO - User deepankar32@gmail.com authorized to execute tool search_stories
2025-10-11 20:09:09,575 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:09:09,575 - tools_gateway.audit - INFO - AUDIT: authz.permission.granted - user:deepankar32@gmail.com - N/A
2025-10-11 20:09:09,575 - tools_gateway.services - DEBUG - Initialized session 39cf0d70-539b-4f74-a23d-95b1e23c3bba with http://127.0.0.1:8001
2025-10-11 20:09:09,577 - tools_gateway.services - DEBUG - Initialized session ca5324a4-6153-4ff5-9dd8-7167f9281554 with http://127.0.0.1:8001
2025-10-11 20:09:09,577 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,577 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,577 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: tool_name=get_story, tool_metadata found=True
2025-10-11 20:09:09,577 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: server_id=mcp_127_0_0_1_8001, oauth_providers=[]
2025-10-11 20:09:09,578 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: local_credentials count=0
INFO:     127.0.0.1:56612 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,578 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,579 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,579 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: tool_name=list_stories, tool_metadata found=True
2025-10-11 20:09:09,579 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: server_id=mcp_127_0_0_1_8001, oauth_providers=[]
2025-10-11 20:09:09,579 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: local_credentials count=0
INFO:     127.0.0.1:56613 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:09:09,584 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:09:09,584 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:09:09,584 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: tool_name=search_stories, tool_metadata found=True
2025-10-11 20:09:09,584 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: server_id=mcp_127_0_0_1_8001, oauth_providers=[]
2025-10-11 20:09:09,584 - tools_gateway.routers.mcp_router - INFO - 🔐 AUTH DEBUG: local_credentials count=0
INFO:     127.0.0.1:56614 - "POST /mcp HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'tools_gateway/rbac.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:14:13,499 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:14:13,499 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:14:13,500 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [12255]
2025-10-11 20:14:13,928 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 20:14:13,928 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [12532]
INFO:     Waiting for application startup.
2025-10-11 20:14:13,937 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 20:14:13,938 - tools_gateway.mcp_storage - INFO - Loaded 1 MCP server configurations from database
2025-10-11 20:14:13,938 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:14:13,938 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:14:13,941 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:14:13,945 - tools_gateway.services - DEBUG - Initialized session 594064c8-3371-43f2-82ab-745388e5ebd6 with http://127.0.0.1:8001
2025-10-11 20:14:13,947 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:14:13,947 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:14:13,947 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 20:14:13,947 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'tools_gateway/routers/mcp_router.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:16:40,797 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:16:40,798 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:16:40,798 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [12532]
2025-10-11 20:16:41,115 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 20:16:41,115 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [12665]
INFO:     Waiting for application startup.
2025-10-11 20:16:41,124 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 20:16:41,125 - tools_gateway.mcp_storage - INFO - Loaded 1 MCP server configurations from database
2025-10-11 20:16:41,125 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:16:41,125 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:16:41,128 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:16:41,130 - tools_gateway.services - DEBUG - Initialized session 460942f4-4c9c-4419-922c-47cbd6d034fe with http://127.0.0.1:8001
2025-10-11 20:16:41,133 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:16:41,133 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:16:41,133 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 20:16:41,133 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
2025-10-11 20:17:11,522 - tools_gateway.routers.admin_users_router - INFO - 🔍 /admin/users endpoint - Authorization header present: True
2025-10-11 20:17:11,525 - tools_gateway.routers.admin_users_router - INFO - 🔍 Token payload: {'sub': 'user_Mi68A0THzHhV4S9O', 'email': 'admin', 'name': 'Administrator', 'provider': 'local', 'exp': 1760266483, 'iat': 1760237683, 'type': 'access'}
2025-10-11 20:17:11,526 - tools_gateway.routers.admin_users_router - INFO - 🔍 User retrieved from email 'admin': True
2025-10-11 20:17:11,526 - tools_gateway.routers.admin_users_router - INFO - 🔍 User details: user_id=user_Mi68A0THzHhV4S9O, email=admin, roles={'admin'}
2025-10-11 20:17:11,526 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=user:view
2025-10-11 20:17:11,526 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:17:11,526 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:17:11,526 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting user:view automatically
2025-10-11 20:17:11,526 - tools_gateway.routers.admin_users_router - INFO - ✅ Permission check passed for user: user_Mi68A0THzHhV4S9O
INFO:     127.0.0.1:56811 - "GET /admin/users HTTP/1.1" 200 OK
2025-10-11 20:17:33,311 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:17:33,311 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:17:33,311 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:17:33,311 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 3328c24c-1f61-4cdb-8ffa-9835f12f0b02
INFO:     127.0.0.1:56831 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:17:33,312 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:17:33,312 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:17:33,312 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:17:33,312 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:56831 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:17:33,313 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:17:33,313 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:17:33,313 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:17:33,313 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:17:33,315 - tools_gateway.services - DEBUG - Initialized session 5198da4f-c495-44e0-a8d6-0835e74ae53e with http://127.0.0.1:8001
2025-10-11 20:17:33,317 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:17:33,317 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:17:33,317 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 20:17:33,317 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool search_stories
2025-10-11 20:17:33,317 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool get_story
2025-10-11 20:17:33,317 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool list_stories
2025-10-11 20:17:33,317 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool count_stories
2025-10-11 20:17:33,317 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user admin
INFO:     127.0.0.1:56831 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:18:02,320 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: None
2025-10-11 20:18:02,320 - tools_gateway.mcp_models - WARNING - Origin validation failed: No origin provided
2025-10-11 20:18:02,320 - tools_gateway.routers.mcp_router - WARNING - Origin validation failed for: None
INFO:     127.0.0.1:56864 - "POST /mcp HTTP/1.1" 403 Forbidden
2025-10-11 20:18:09,209 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:18:09,210 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:18:09,210 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:18:09,210 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:18:09,212 - tools_gateway.services - DEBUG - Initialized session 20651d4d-a0dc-4dda-be40-1fff37067e3a with http://127.0.0.1:8001
2025-10-11 20:18:09,214 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:18:09,214 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:18:09,214 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:18:09,214 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:18:09,214 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'search_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:18:09,214 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool search_stories
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:18:09,214 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:18:09,215 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:18:09,215 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:18:09,215 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:18:09,215 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'count_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:18:09,215 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool count_stories
2025-10-11 20:18:09,215 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 0 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:56880 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:18:34,635 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:18:34,635 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:18:34,635 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:18:34,635 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:56917 - "GET /admin/roles HTTP/1.1" 200 OK
2025-10-11 20:18:44,498 - tools_gateway.routers.mcp_router - INFO - GET endpoint - Extracted origin: None
2025-10-11 20:18:44,498 - tools_gateway.mcp_models - WARNING - Origin validation failed: No origin provided
2025-10-11 20:18:44,498 - tools_gateway.routers.mcp_router - WARNING - Origin validation failed for: None
INFO:     127.0.0.1:56934 - "GET /mcp HTTP/1.1" 403 Forbidden
2025-10-11 20:19:20,624 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:19:20,624 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:20,624 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:19:20,624 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:19:20,624 - tools_gateway.database - INFO - Set 1 tool permissions for role user on server mcp_127_0_0_1_8001
2025-10-11 20:19:20,625 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:19:20,626 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:57381 - "POST /admin/tools/mcp_127_0_0_1_8001/search_stories/roles HTTP/1.1" 200 OK
2025-10-11 20:19:35,164 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:19:35,164 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:19:35,164 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:19:35,164 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:19:35,166 - tools_gateway.services - DEBUG - Initialized session ef5cca15-8fce-4868-ad6f-25ba90eb7a5b with http://127.0.0.1:8001
2025-10-11 20:19:35,169 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:19:35,169 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:19:35,169 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:19:35,169 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,169 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:19:35,170 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:19:35,170 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:19:35,170 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:19:35,170 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'count_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:19:35,170 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool count_stories
2025-10-11 20:19:35,170 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 1 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57599 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:19:53,840 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:19:53,840 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:53,840 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:19:53,840 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:19:53,840 - tools_gateway.database - INFO - Set 1 tool permissions for role user on server mcp_127_0_0_1_8001
2025-10-11 20:19:53,840 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:19:53,840 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:57621 - "POST /admin/tools/mcp_127_0_0_1_8001/get_story/roles HTTP/1.1" 200 OK
2025-10-11 20:19:53,847 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:19:53,847 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:53,847 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:19:53,847 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:19:53,847 - tools_gateway.database - INFO - Set 1 tool permissions for role user on server mcp_127_0_0_1_8001
2025-10-11 20:19:53,847 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:19:53,847 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:57623 - "POST /admin/tools/mcp_127_0_0_1_8001/list_stories/roles HTTP/1.1" 200 OK
2025-10-11 20:19:53,855 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:19:53,855 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:19:53,855 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:19:53,855 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:19:53,855 - tools_gateway.database - INFO - Set 1 tool permissions for role user on server mcp_127_0_0_1_8001
2025-10-11 20:19:53,855 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:19:53,855 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:57625 - "POST /admin/tools/mcp_127_0_0_1_8001/count_stories/roles HTTP/1.1" 200 OK
2025-10-11 20:20:07,470 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:20:07,470 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:20:07,470 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:20:07,470 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:20:07,472 - tools_gateway.services - DEBUG - Initialized session 9d4befa2-4e94-484c-8246-4bf6db5054f9 with http://127.0.0.1:8001
2025-10-11 20:20:07,474 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:20:07,474 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:20:07,475 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'search_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:20:07,475 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool search_stories
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:20:07,475 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:20:07,475 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:20:07,475 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:20:07,475 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:20:07,475 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 1 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57648 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:20:24,851 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:20:24,851 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:20:24,851 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:20:24,852 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:57684 - "GET /admin/roles/user/tools HTTP/1.1" 200 OK
2025-10-11 20:21:19,857 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:21:19,857 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:21:19,857 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:21:19,857 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:21:19,860 - tools_gateway.services - DEBUG - Initialized session 3d2767e8-1280-42d9-b6f1-9c53687fb881 with http://127.0.0.1:8001
2025-10-11 20:21:19,862 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:21:19,862 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:21:19,863 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'search_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:19,863 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool search_stories
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:19,863 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:19,863 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:19,863 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:19,863 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:21:19,863 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 1 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57757 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:21:54,737 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:21:54,737 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', 'localhost', '127.0.0.1'}
2025-10-11 20:21:54,737 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:21:54,737 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:21:54,739 - tools_gateway.services - DEBUG - Initialized session cb6d2ed4-3144-4f3a-83c2-63e69eb0d796 with http://127.0.0.1:8001
2025-10-11 20:21:54,740 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:21:54,740 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:21:54,740 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:21:54,740 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:54,740 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'search_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:54,741 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool search_stories
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:54,741 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:21:54,741 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:21:54,741 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:21:54,741 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:21:54,741 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 1 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57831 - "POST /mcp HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'tools_gateway/rbac.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:22:04,433 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:22:04,433 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:22:04,435 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [12665]
2025-10-11 20:22:04,873 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 20:22:04,873 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [13758]
INFO:     Waiting for application startup.
2025-10-11 20:22:04,883 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 20:22:04,883 - tools_gateway.mcp_storage - INFO - Loaded 1 MCP server configurations from database
2025-10-11 20:22:04,883 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:22:04,883 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:22:04,886 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:22:04,890 - tools_gateway.services - DEBUG - Initialized session cf4f66aa-f499-4153-bd6d-a8e41c9d8f4c with http://127.0.0.1:8001
2025-10-11 20:22:04,891 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:22:04,892 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:22:04,892 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 20:22:04,892 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
2025-10-11 20:22:20,343 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:22:20,343 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:22:20,343 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:22:20,343 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:22:20,345 - tools_gateway.services - DEBUG - Initialized session 66b308ec-e096-4da4-8105-7fd7a91574e8 with http://127.0.0.1:8001
2025-10-11 20:22:20,348 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:22:20,348 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:22:20,351 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,351 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:22:20,351 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:22:20,351 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'search_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:22:20,352 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool search_stories
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:22:20,352 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'get_story' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:22:20,352 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool get_story
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:22:20,352 - tools_gateway.rbac - WARNING - ❌ RBAC: User user_fU6IZAPwaNLZbA1H (email: deepankar32@gmail.com) denied access to tool 'list_stories' on server 'mcp_127_0_0_1_8001' - No explicit role assignment found
2025-10-11 20:22:20,352 - tools_gateway.routers.mcp_router - DEBUG - User deepankar32@gmail.com denied access to tool list_stories
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:22:20,352 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:22:20,352 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:22:20,352 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 1 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57869 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:23:13,435 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8023
2025-10-11 20:23:13,435 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:23:13,435 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8023
2025-10-11 20:23:13,435 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:23:13,438 - tools_gateway.services - DEBUG - Initialized session 7dddeff6-83ce-4cfe-bec6-726f301e1b94 with http://127.0.0.1:8001
2025-10-11 20:23:13,440 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:23:13,440 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:23:13,441 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:23:13,441 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:23:13,442 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:23:13,442 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:23:13,442 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:23:13,442 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:57994 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:24:12,512 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:24:12,512 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:24:12,513 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:24:12,513 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 80d45206-feb4-49dc-9ca8-cf078cb2c7ee
INFO:     127.0.0.1:58040 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:24:12,516 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:24:12,517 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:24:12,517 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:24:12,517 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:58040 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:24:12,520 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:24:12,521 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:24:12,521 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:24:12,521 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:24:12,524 - tools_gateway.services - DEBUG - Initialized session dbfd6d89-13f3-4def-a861-feb59ff4198a with http://127.0.0.1:8001
2025-10-11 20:24:12,527 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:24:12,527 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:24:12,528 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,528 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:24:12,529 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:24:12,529 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:24:12,529 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:24:12,530 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:24:12,530 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:24:12,531 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:24:12,531 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:24:12,531 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:58040 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:28:43,969 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:43,969 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:43,969 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:43,969 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 3ff22c3d-29a2-422a-866f-9100c986ceaf
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:28:43,973 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:43,973 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:43,973 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:43,973 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:28:43,978 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:43,978 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:43,978 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:43,978 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:28:43,981 - tools_gateway.services - DEBUG - Initialized session 73309ab3-1d05-41e1-9906-3440f7aff398 with http://127.0.0.1:8001
2025-10-11 20:28:43,984 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:28:43,984 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:28:43,985 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:43,985 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:43,986 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,986 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:43,987 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:43,987 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:43,987 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:43,988 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:43,988 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:43,988 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:28:47,321 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:47,321 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:47,321 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:47,321 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session abc3c226-3307-4b49-b8e7-933a34c11c90
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:28:47,323 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:47,323 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:47,323 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:47,323 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:28:47,325 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:28:47,325 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:28:47,325 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:28:47,325 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:28:47,327 - tools_gateway.services - DEBUG - Initialized session 129cfd18-841e-400c-89a5-a88e38b68e2c with http://127.0.0.1:8001
2025-10-11 20:28:47,329 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:28:47,330 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:28:47,330 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:28:47,330 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:47,330 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,330 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:47,331 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:47,331 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:47,331 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:47,332 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:28:47,332 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:28:47,332 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:28:47,333 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:28:47,333 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:58475 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:29:02,546 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:29:02,547 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:29:02,548 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:29:02,548 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:58487 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:29:09,079 - tools_gateway.routers.auth_router - INFO - OAuth callback-redirect received - state: MoLmjQYyTXJ4-aPOKUyL...
2025-10-11 20:29:09,340 - tools_gateway.auth - INFO - Successfully exchanged code for token: google
2025-10-11 20:29:09,341 - tools_gateway.routers.auth_router - INFO - Token exchange successful for provider: google
2025-10-11 20:29:09,528 - tools_gateway.auth - INFO - Retrieved user info for deepankar32@gmail.com from google
2025-10-11 20:29:09,529 - tools_gateway.routers.auth_router - INFO - User info retrieved: email=deepankar32@gmail.com, name=Kumar Deepankar
2025-10-11 20:29:09,530 - tools_gateway.routers.auth_router - INFO - User created/retrieved: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:29:09,531 - tools_gateway.auth - INFO - Created access token for deepankar32@gmail.com
2025-10-11 20:29:09,531 - tools_gateway.routers.auth_router - INFO - JWT token created for user: deepankar32@gmail.com
2025-10-11 20:29:09,533 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:29:09,534 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:deepankar32@gmail.com - N/A
2025-10-11 20:29:09,535 - tools_gateway.routers.auth_router - INFO - Redirecting to external service: http://localhost:8023/auth/callback...
INFO:     127.0.0.1:58499 - "GET /auth/callback-redirect?state=MoLmjQYyTXJ4-aPOKUyL1TwcqvZZcqbh7RBAbpfvb4M&code=4%2F0AVGzR1BEBep4w72YK2dHLhilrcVJMVaG_oqR9MfhPjwZ5iXgvBSiF25Ja4wrWP2luWllyQ&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+openid&authuser=0&prompt=consent HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:29:09,711 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:29:09,711 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:29:09,712 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:29:09,712 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session be4d7842-feaf-4747-bf07-d8fc48a87d4c
INFO:     127.0.0.1:58506 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:29:09,715 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:29:09,715 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:29:09,715 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:29:09,715 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:58506 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:29:09,719 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:29:09,719 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'127.0.0.1', '0.0.0.0', 'localhost'}
2025-10-11 20:29:09,719 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:29:09,719 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:29:09,722 - tools_gateway.services - DEBUG - Initialized session 1a4f9b16-93e0-45ee-bd77-b98ae4ab8518 with http://127.0.0.1:8001
2025-10-11 20:29:09,724 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:29:09,724 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:29:09,725 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:29:09,725 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:29:09,725 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:29:09,726 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,726 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:29:09,726 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:29:09,727 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:29:09,727 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:29:09,727 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:58506 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:31:52,383 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:31:52,383 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'cache-control': 'max-age=0', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'sec-fetch-site': 'same-origin', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'referer': 'http://localhost:8021/static/login.html', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667; Pycharm-7c76b434=0daae8ca-c8a9-4ebc-94e7-ad5b5a87c661'}
INFO:     127.0.0.1:58598 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:58605 - "GET /static/images/logo.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:58606 - "GET /static/js/admin-security.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58607 - "GET /static/js/admin-ad-fetched.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58598 - "GET /static/css/mcp-portal.css?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58599 - "GET /static/css/oauth-forms.css?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58603 - "GET /static/js/mcp-portal.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58607 - "GET /static/js/auth.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:58607 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:58603 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:58607 - "GET /static/login.html HTTP/1.1" 200 OK
INFO:     127.0.0.1:58607 - "GET /auth/providers HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'agentic_search/auth_routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:32:21,429 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:32:21,429 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:32:21,429 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [13758]
2025-10-11 20:32:21,802 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 20:32:21,802 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [14837]
INFO:     Waiting for application startup.
2025-10-11 20:32:21,811 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 20:32:21,811 - tools_gateway.mcp_storage - INFO - Loaded 1 MCP server configurations from database
2025-10-11 20:32:21,811 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:32:21,811 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:32:21,815 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:32:21,819 - tools_gateway.services - DEBUG - Initialized session 203ea42f-8e47-4a94-9a9f-a6961f2f9802 with http://127.0.0.1:8001
2025-10-11 20:32:21,820 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:32:21,820 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:32:21,820 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 20:32:21,820 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'agentic_search/auth_routes.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:33:33,545 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:33:33,545 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:33:33,546 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [14837]
2025-10-11 20:33:33,861 - tools_gateway.mcp_models - INFO - MCP Toolbox Gateway initialized with protocol version 2025-06-18
2025-10-11 20:33:33,862 - tools_gateway.mcp_models - INFO - Compliance components initialized: EventStore, StreamManager, MessageRouter
INFO:     Started server process [14872]
INFO:     Waiting for application startup.
2025-10-11 20:33:33,871 - tools_gateway.main - INFO - Tools Gateway starting up...
2025-10-11 20:33:33,871 - tools_gateway.mcp_storage - INFO - Loaded 1 MCP server configurations from database
2025-10-11 20:33:33,871 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:33:33,871 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:33:33,875 - tools_gateway.services - INFO - New aiohttp.ClientSession created with SSL verification disabled and increased buffer limits.
2025-10-11 20:33:33,878 - tools_gateway.services - DEBUG - Initialized session 2c6477c2-d2bc-486b-9ef0-42e9410681a0 with http://127.0.0.1:8001
2025-10-11 20:33:33,880 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:33:33,880 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:33:33,881 - tools_gateway.services - INFO - Started connection health monitoring
2025-10-11 20:33:33,881 - tools_gateway.main - INFO - Connection health monitoring started
INFO:     Application startup complete.
INFO:     127.0.0.1:58852 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:58858 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:58877 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:58921 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:37:17,790 - tools_gateway.rbac - WARNING - Authentication failed: Invalid password - admin
2025-10-11 20:37:17,790 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:37:17,790 - tools_gateway.audit - WARNING - AUDIT: auth.login.failure - user:admin - N/A
INFO:     127.0.0.1:58945 - "POST /auth/login/local HTTP/1.1" 401 Unauthorized
2025-10-11 20:37:44,042 - tools_gateway.rbac - WARNING - Authentication failed: Invalid password - admin
2025-10-11 20:37:44,042 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:37:44,042 - tools_gateway.audit - WARNING - AUDIT: auth.login.failure - user:admin - N/A
INFO:     127.0.0.1:59021 - "POST /auth/login/local HTTP/1.1" 401 Unauthorized
2025-10-11 20:38:33,887 - tools_gateway.services - WARNING - Server http://127.0.0.1:8001 connection is stale, attempting refresh
2025-10-11 20:38:33,892 - tools_gateway.services - DEBUG - Health check passed for http://127.0.0.1:8001
2025-10-11 20:38:33,892 - tools_gateway.services - INFO - Refreshing tool index...
2025-10-11 20:38:33,892 - tools_gateway.services - INFO - Using 1 servers from storage
2025-10-11 20:38:33,894 - tools_gateway.services - DEBUG - Initialized session 96d708a6-c8d6-4a94-b2fb-5caad4423d26 with http://127.0.0.1:8001
2025-10-11 20:38:33,896 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:38:33,897 - tools_gateway.services - INFO - Tool index refreshed. Found 4 unique tools.
2025-10-11 20:38:55,245 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:38:55,253 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:38:55,254 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:38:55,255 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:59077 - "POST /auth/login/local HTTP/1.1" 200 OK
2025-10-11 20:38:55,298 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:38:55,298 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:38:55,298 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:38:55,298 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 118eac89-f94b-4d78-b607-183290d5c8c6
INFO:     127.0.0.1:59081 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:38:55,301 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:38:55,301 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:38:55,301 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:38:55,301 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59081 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:38:55,303 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:38:55,303 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:38:55,303 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:38:55,303 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:38:55,305 - tools_gateway.services - DEBUG - Initialized session 2080ed8c-ecbd-4c09-9517-06415a44e135 with http://127.0.0.1:8001
2025-10-11 20:38:55,306 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:38:55,307 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:38:55,307 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 20:38:55,307 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool search_stories
2025-10-11 20:38:55,307 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool get_story
2025-10-11 20:38:55,307 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool list_stories
2025-10-11 20:38:55,307 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool count_stories
2025-10-11 20:38:55,307 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user admin
INFO:     127.0.0.1:59081 - "POST /mcp HTTP/1.1" 200 OK
INFO:     127.0.0.1:59088 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:39:03,663 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:39:03,663 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:39:03,664 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:03,665 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:59090 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:39:04,000 - tools_gateway.routers.auth_router - INFO - OAuth callback-redirect received - state: axbZK8Xb9wk-s1QUoXC8...
2025-10-11 20:39:04,182 - tools_gateway.auth - INFO - Successfully exchanged code for token: google
2025-10-11 20:39:04,183 - tools_gateway.routers.auth_router - INFO - Token exchange successful for provider: google
2025-10-11 20:39:04,347 - tools_gateway.auth - INFO - Retrieved user info for deepankar32@gmail.com from google
2025-10-11 20:39:04,348 - tools_gateway.routers.auth_router - INFO - User info retrieved: email=deepankar32@gmail.com, name=Kumar Deepankar
2025-10-11 20:39:04,350 - tools_gateway.routers.auth_router - INFO - User created/retrieved: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:39:04,351 - tools_gateway.auth - INFO - Created access token for deepankar32@gmail.com
2025-10-11 20:39:04,351 - tools_gateway.routers.auth_router - INFO - JWT token created for user: deepankar32@gmail.com
2025-10-11 20:39:04,352 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:04,353 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:deepankar32@gmail.com - N/A
2025-10-11 20:39:04,354 - tools_gateway.routers.auth_router - INFO - Redirecting to external service: http://localhost:8023/auth/callback...
INFO:     127.0.0.1:59090 - "GET /auth/callback-redirect?state=axbZK8Xb9wk-s1QUoXC8mjD41fzMfKlvxW7bs1xHiGk&code=4%2F0AVGzR1C904EcbC8lCB0ug1ml4ab7JPzSSETKtxgGS88EdbG89Z2OK3L-s6imqJIoQ3Q-9w&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+openid&authuser=0&prompt=none HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:39:04,390 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:04,390 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:04,390 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:04,390 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 6b6ae100-bd56-4d3f-aeaf-3484989f33f4
INFO:     127.0.0.1:59094 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:39:04,393 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:04,393 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:04,393 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:04,393 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59094 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:39:04,395 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:04,396 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:04,396 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:04,396 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:39:04,398 - tools_gateway.services - DEBUG - Initialized session ab6bc81c-586d-486f-9566-587b981b08b7 with http://127.0.0.1:8001
2025-10-11 20:39:04,400 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:39:04,401 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:39:04,401 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:39:04,401 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:39:04,401 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:39:04,402 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:39:04,402 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:39:04,402 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:39:04,403 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,403 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:39:04,404 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:39:04,404 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:39:04,404 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59094 - "POST /mcp HTTP/1.1" 200 OK
INFO:     127.0.0.1:59096 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:39:14,960 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:39:14,961 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:39:14,962 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:14,962 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:59098 - "POST /auth/login/local HTTP/1.1" 200 OK
INFO:     127.0.0.1:59098 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:59100 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:59102 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:59104 - "GET /auth/user HTTP/1.1" 200 OK
2025-10-11 20:39:18,819 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:18,819 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:18,819 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:18,820 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session f2ca5dd2-952a-4b57-ba72-29f715c1198c
INFO:     127.0.0.1:59104 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:39:18,823 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:18,823 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:18,824 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:18,824 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59104 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:39:18,826 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:39:18,826 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:39:18,826 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:39:18,826 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:39:18,831 - tools_gateway.services - DEBUG - Initialized session ee680701-efdf-46bb-9678-da12c8e96a96 with http://127.0.0.1:8001
2025-10-11 20:39:18,834 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:39:18,834 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:39:18,834 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59104 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:39:18,838 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:39:18,838 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:18,838 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:39:18,838 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:59104 - "GET /admin/roles HTTP/1.1" 200 OK
2025-10-11 20:39:32,891 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:39:32,892 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:32,892 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:39:32,892 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:39:32,894 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:32,894 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:59107 - "POST /admin/tools/mcp_127_0_0_1_8001/get_story/roles HTTP/1.1" 200 OK
2025-10-11 20:39:37,360 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:39:37,360 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:39:37,361 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:39:37,361 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:39:37,362 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:37,363 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:59107 - "POST /admin/tools/mcp_127_0_0_1_8001/list_stories/roles HTTP/1.1" 200 OK
INFO:     127.0.0.1:59112 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:39:56,420 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:39:56,420 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:39:56,421 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:39:56,421 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:59116 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
INFO:     127.0.0.1:59119 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:40:11,592 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:40:11,593 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:40:11,594 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:40:11,595 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:59120 - "POST /auth/login/local HTTP/1.1" 200 OK
2025-10-11 20:40:11,629 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:11,629 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:11,630 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:11,630 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session f841bf08-8254-4253-ba06-710dc1e0748a
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:11,632 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:11,632 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:11,632 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:11,632 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:11,634 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:11,634 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:11,635 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:11,635 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:11,637 - tools_gateway.services - DEBUG - Initialized session 2f30a0b0-beac-44d7-a627-4c34c2177fb2 with http://127.0.0.1:8001
2025-10-11 20:40:11,639 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:11,639 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:11,640 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 20:40:11,640 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool search_stories
2025-10-11 20:40:11,640 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool get_story
2025-10-11 20:40:11,640 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool list_stories
2025-10-11 20:40:11,641 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool count_stories
2025-10-11 20:40:11,641 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user admin
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:15,266 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,266 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,266 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,266 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 1e4efcab-d9ea-4fe0-a50a-bcf1f281830a
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:15,270 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,270 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,270 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,270 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:15,274 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,274 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,274 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,274 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:15,277 - tools_gateway.services - DEBUG - Initialized session 06b1ea80-a801-44c7-8f1c-f3aee41c347d with http://127.0.0.1:8001
2025-10-11 20:40:15,280 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:15,281 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:15,281 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 20:40:15,281 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool search_stories
2025-10-11 20:40:15,281 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool get_story
2025-10-11 20:40:15,282 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool list_stories
2025-10-11 20:40:15,282 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool count_stories
2025-10-11 20:40:15,282 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user admin
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:15,793 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,793 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,793 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,793 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session bdae6ae3-69ed-45c7-83a4-deb56215abe1
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:15,798 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,799 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,799 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,799 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:15,802 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:15,802 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:15,802 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:15,802 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:15,805 - tools_gateway.services - DEBUG - Initialized session 9b7fa1da-473c-40db-a329-911619f84fa7 with http://127.0.0.1:8001
2025-10-11 20:40:15,808 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:15,808 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:15,809 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user admin with roles {'admin'}
2025-10-11 20:40:15,809 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool search_stories
2025-10-11 20:40:15,809 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool get_story
2025-10-11 20:40:15,809 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool list_stories
2025-10-11 20:40:15,809 - tools_gateway.rbac - INFO - ✅ RBAC: User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - allowing tool count_stories
2025-10-11 20:40:15,809 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user admin
INFO:     127.0.0.1:59124 - "POST /mcp HTTP/1.1" 200 OK
INFO:     127.0.0.1:59128 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:59129 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:40:30,807 - tools_gateway.auth - INFO - Created authorization URL for provider google
2025-10-11 20:40:30,807 - tools_gateway.routers.auth_router - INFO - Initiated cross-origin OAuth for provider google, will redirect to http://localhost:8023/auth/callback
2025-10-11 20:40:30,809 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:40:30,809 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:anonymous - N/A
INFO:     127.0.0.1:59143 - "GET /auth/login-redirect?provider_id=google&redirect_to=http://localhost:8023/auth/callback HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:40:35,155 - tools_gateway.routers.auth_router - INFO - OAuth callback-redirect received - state: SMCAQsUTQ6Su05kT19-R...
2025-10-11 20:40:35,397 - tools_gateway.auth - INFO - Successfully exchanged code for token: google
2025-10-11 20:40:35,398 - tools_gateway.routers.auth_router - INFO - Token exchange successful for provider: google
2025-10-11 20:40:35,571 - tools_gateway.auth - INFO - Retrieved user info for deepankar32@gmail.com from google
2025-10-11 20:40:35,572 - tools_gateway.routers.auth_router - INFO - User info retrieved: email=deepankar32@gmail.com, name=Kumar Deepankar
2025-10-11 20:40:35,574 - tools_gateway.routers.auth_router - INFO - User created/retrieved: user_id=user_fU6IZAPwaNLZbA1H, email=deepankar32@gmail.com, roles={'user'}
2025-10-11 20:40:35,574 - tools_gateway.auth - INFO - Created access token for deepankar32@gmail.com
2025-10-11 20:40:35,575 - tools_gateway.routers.auth_router - INFO - JWT token created for user: deepankar32@gmail.com
2025-10-11 20:40:35,576 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:40:35,577 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:deepankar32@gmail.com - N/A
2025-10-11 20:40:35,577 - tools_gateway.routers.auth_router - INFO - Redirecting to external service: http://localhost:8023/auth/callback...
INFO:     127.0.0.1:59143 - "GET /auth/callback-redirect?state=SMCAQsUTQ6Su05kT19-Rm9PgjTg2HCvoC4K_wTqinV8&code=4%2F0AVGzR1BDFyXq8n7QP72g7S_bplX38dy5ZFADv0kjZy5c5OmjkBBzYL2Mvwbf4jh5r0AroQ&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+openid&authuser=0&prompt=consent HTTP/1.1" 307 Temporary Redirect
2025-10-11 20:40:35,763 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:35,763 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:35,763 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:35,763 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 4a20d26f-201d-49ea-8dce-a32db63420f6
INFO:     127.0.0.1:59155 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:35,768 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:35,768 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:35,768 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:35,768 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59155 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:35,771 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:35,771 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:35,771 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:35,771 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:35,773 - tools_gateway.services - DEBUG - Initialized session 4d6af97d-9d04-43e2-b1cb-7eec240d69b6 with http://127.0.0.1:8001
2025-10-11 20:40:35,775 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:35,775 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:35,776 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:40:35,776 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,776 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:40:35,777 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:40:35,777 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:40:35,777 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:40:35,778 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:40:35,778 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:40:35,778 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59155 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:41,510 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:41,510 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:41,510 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:41,511 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 85f5ae58-88b3-47e1-983d-c992f008621f
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:41,516 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:41,516 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:41,516 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:41,516 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:41,519 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:41,519 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:41,520 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:41,520 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:41,524 - tools_gateway.services - DEBUG - Initialized session 4566a807-3d42-479f-b5a0-c5e12bf4b2af with http://127.0.0.1:8001
2025-10-11 20:40:41,527 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:41,527 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:41,527 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,340 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,341 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,341 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,341 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session dc890c22-7e80-4bab-9c4d-5ca9fe71473e
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,346 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,346 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,346 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,346 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:42,350 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,351 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,351 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,351 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:42,355 - tools_gateway.services - DEBUG - Initialized session 19313480-8dce-4a7c-b6fe-27faf828ab03 with http://127.0.0.1:8001
2025-10-11 20:40:42,358 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:42,358 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:42,359 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,550 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,551 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,551 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,551 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session b2a0f9c2-4753-4c2d-b883-4c8b95d48825
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,556 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,557 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,557 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,557 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:42,562 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,562 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,562 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,562 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:42,566 - tools_gateway.services - DEBUG - Initialized session 80b4f703-5925-4abc-a08f-540d82a061d4 with http://127.0.0.1:8001
2025-10-11 20:40:42,569 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:42,570 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:42,570 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,770 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,770 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,770 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,770 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 6f5d2eb0-0eab-4e94-904e-48ffb33f3acc
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:42,775 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,775 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,775 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,776 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:40:42,779 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:40:42,780 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:40:42,780 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:40:42,780 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:40:42,784 - tools_gateway.services - DEBUG - Initialized session 7138aabe-4027-4160-a507-a0a4d612a111 with http://127.0.0.1:8001
2025-10-11 20:40:42,787 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:40:42,787 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:40:42,788 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59159 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:40:54,195 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:40:54,196 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'cache-control': 'max-age=0', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'sec-fetch-site': 'same-origin', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'referer': 'http://localhost:8021/static/login.html', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667; Pycharm-7c76b434=0daae8ca-c8a9-4ebc-94e7-ad5b5a87c661; session_id=L2zANbG9GJdyHYL6DnC0GMBWu1cqyXmQYJl6qJC-DvU'}
INFO:     127.0.0.1:59163 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:59172 - "GET /static/js/admin-ad-fetched.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59164 - "GET /static/css/oauth-forms.css?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59163 - "GET /static/css/mcp-portal.css?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59171 - "GET /static/js/admin-security.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59170 - "GET /static/images/logo.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:59168 - "GET /static/js/mcp-portal.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59171 - "GET /static/js/auth.js?v=9 HTTP/1.1" 200 OK
INFO:     127.0.0.1:59171 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:59168 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:59171 - "GET /static/login.html HTTP/1.1" 200 OK
INFO:     127.0.0.1:59171 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:41:05,711 - tools_gateway.rbac - INFO - Local user authenticated successfully: admin
2025-10-11 20:41:05,711 - tools_gateway.auth - INFO - Created access token for admin
2025-10-11 20:41:05,712 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:41:05,713 - tools_gateway.audit - INFO - AUDIT: auth.login.success - user:admin - N/A
INFO:     127.0.0.1:59174 - "POST /auth/login/local HTTP/1.1" 200 OK
INFO:     127.0.0.1:59174 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:59176 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:59178 - "GET /auth/providers HTTP/1.1" 200 OK
INFO:     127.0.0.1:59174 - "GET /auth/user HTTP/1.1" 200 OK
2025-10-11 20:41:09,032 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:09,032 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:09,033 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:09,033 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 538545f1-bc6c-466e-a012-0f89a9ad7db3
INFO:     127.0.0.1:59174 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:09,038 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:09,038 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:09,038 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:09,038 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59174 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:09,043 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:09,043 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:09,043 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:09,043 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:09,048 - tools_gateway.services - DEBUG - Initialized session c4b2b32d-11fd-43fa-90b2-93fea509069f with http://127.0.0.1:8001
2025-10-11 20:41:09,051 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:09,052 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:09,052 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59174 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:09,057 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:41:09,057 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:09,057 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:09,058 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:59174 - "GET /admin/roles HTTP/1.1" 200 OK
2025-10-11 20:41:11,355 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:11,355 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:11,355 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:11,355 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 50e5294a-8378-4586-be3b-48cf9a6339b5
INFO:     127.0.0.1:59185 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:11,359 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:11,360 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:11,360 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:11,360 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59185 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:11,363 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:11,364 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:11,364 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:11,364 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:11,366 - tools_gateway.services - DEBUG - Initialized session 5a6b2a77-011e-4f87-8236-db52cb343662 with http://127.0.0.1:8001
2025-10-11 20:41:11,369 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:11,369 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:11,370 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:11,370 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:11,370 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:11,371 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,371 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:11,372 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:11,372 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:11,372 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:11,372 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59185 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:14,547 - tools_gateway.main - INFO - Root request from: 127.0.0.1
2025-10-11 20:41:14,547 - tools_gateway.main - INFO - Headers: {'host': 'localhost:8021', 'connection': 'keep-alive', 'cache-control': 'max-age=0', 'sec-ch-ua': '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"', 'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"macOS"', 'upgrade-insecure-requests': '1', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36', 'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'sec-fetch-site': 'same-origin', 'sec-fetch-mode': 'navigate', 'sec-fetch-user': '?1', 'sec-fetch-dest': 'document', 'referer': 'http://localhost:8021/static/login.html', 'accept-encoding': 'gzip, deflate, br, zstd', 'accept-language': 'en-US,en;q=0.9', 'cookie': '_ga=GA1.1.1564648986.1758110667; Pycharm-7c76b434=0daae8ca-c8a9-4ebc-94e7-ad5b5a87c661; session_id=L2zANbG9GJdyHYL6DnC0GMBWu1cqyXmQYJl6qJC-DvU', 'if-none-match': '"b59070789ca14b40837d4d6d265f531b"', 'if-modified-since': 'Sat, 11 Oct 2025 18:54:12 GMT'}
INFO:     127.0.0.1:59188 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:59188 - "POST /manage HTTP/1.1" 200 OK
INFO:     127.0.0.1:59189 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:59188 - "GET /auth/user HTTP/1.1" 200 OK
INFO:     127.0.0.1:59189 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:41:15,828 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:15,828 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:15,828 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:15,829 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 61c7b322-6312-4f71-9196-94f7246888d3
INFO:     127.0.0.1:59189 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:15,833 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:15,834 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:15,834 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:15,834 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59189 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:15,837 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:15,837 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:15,837 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:15,838 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:15,841 - tools_gateway.services - DEBUG - Initialized session e508f5e5-f4dc-495c-be74-b9909ea7b403 with http://127.0.0.1:8001
2025-10-11 20:41:15,844 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:15,844 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:15,844 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59189 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:15,849 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:41:15,849 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:15,849 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:15,849 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:59189 - "GET /admin/roles HTTP/1.1" 200 OK
2025-10-11 20:41:20,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:41:20,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:20,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:20,727 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:41:20,729 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:41:20,730 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:59189 - "POST /admin/tools/mcp_127_0_0_1_8001/get_story/roles HTTP/1.1" 200 OK
2025-10-11 20:41:24,551 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:41:24,551 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:24,552 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:24,552 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:41:24,554 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:41:24,555 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:59189 - "POST /admin/tools/mcp_127_0_0_1_8001/list_stories/roles HTTP/1.1" 200 OK
2025-10-11 20:41:28,295 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:manage
2025-10-11 20:41:28,295 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:28,295 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:28,296 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:manage automatically
2025-10-11 20:41:28,298 - tools_gateway.database - INFO - Kept last 5 audit logs, deleted 1 old entries
2025-10-11 20:41:28,299 - tools_gateway.audit - INFO - AUDIT: config.updated - user:admin - N/A
INFO:     127.0.0.1:59189 - "POST /admin/tools/mcp_127_0_0_1_8001/count_stories/roles HTTP/1.1" 200 OK
2025-10-11 20:41:30,987 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:30,988 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:30,988 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:30,988 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session b2e74387-7910-429c-9024-adffce6dae4e
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:30,992 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:30,992 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:30,992 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:30,992 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:30,996 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:30,996 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:30,996 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:30,996 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:31,000 - tools_gateway.services - DEBUG - Initialized session 545d159e-a642-4cfb-a159-68db414b2663 with http://127.0.0.1:8001
2025-10-11 20:41:31,002 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:31,002 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:31,003 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,003 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,003 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,004 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,004 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,005 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,005 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,005 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,005 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,460 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,460 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,460 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,461 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session da6dc196-fe43-4bc8-80d3-a56ea45e37b2
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,465 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,465 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,465 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,465 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:31,468 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,469 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,469 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,469 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:31,471 - tools_gateway.services - DEBUG - Initialized session 4d1b3d69-9ca5-4662-8385-a81a9fca185c with http://127.0.0.1:8001
2025-10-11 20:41:31,474 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:31,474 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:31,474 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,475 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,475 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,476 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,476 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,476 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,477 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,477 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,477 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,684 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,684 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,684 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,684 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session fd93e604-d8ec-4a27-8271-580080c15b0d
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,688 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,688 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,688 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,688 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:31,691 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,692 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,692 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,692 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:31,694 - tools_gateway.services - DEBUG - Initialized session bcdfccc9-c518-4552-8c39-073af15f9d60 with http://127.0.0.1:8001
2025-10-11 20:41:31,696 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:31,696 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:31,697 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,697 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,697 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,698 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,698 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,698 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,699 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,699 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,699 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,880 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,881 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,881 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,881 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 673d058a-3283-4d44-9181-386a45284e9f
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:31,885 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,885 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,885 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,885 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:31,889 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:31,889 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:31,889 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:31,890 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:31,892 - tools_gateway.services - DEBUG - Initialized session edf1ea3a-0a06-4b84-8f60-a0b33e1790e8 with http://127.0.0.1:8001
2025-10-11 20:41:31,894 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:31,894 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:31,895 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,895 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,895 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,896 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,896 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,896 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:31,897 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:31,897 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:31,897 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,082 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,083 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,083 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,083 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 775c42f9-1e15-4e53-accd-cf0ee11be9b8
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,088 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,088 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,088 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,088 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:32,092 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,092 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,092 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,093 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:32,095 - tools_gateway.services - DEBUG - Initialized session 2841cd36-cd8c-4de0-b559-12d95bd68497 with http://127.0.0.1:8001
2025-10-11 20:41:32,097 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:32,097 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:32,098 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,098 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,098 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,099 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,099 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,099 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,100 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,100 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,100 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,292 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,293 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,293 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,293 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session eb328ac1-218e-45be-b4bf-1741bfab5d53
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,297 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,297 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,297 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,297 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:32,300 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,300 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,300 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,300 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:32,303 - tools_gateway.services - DEBUG - Initialized session 2d7e9f79-dcd4-4457-8d17-8415bae10ac2 with http://127.0.0.1:8001
2025-10-11 20:41:32,306 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:32,306 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:32,307 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,307 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,307 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,308 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,308 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,308 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,309 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,309 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,309 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,510 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,510 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,510 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,510 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 2bb77bb1-1ff6-4554-9a5e-f1f29e0e0951
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,515 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,515 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,515 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,515 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:32,518 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,518 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,518 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,518 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:32,520 - tools_gateway.services - DEBUG - Initialized session 5ed01456-a47d-4ac4-8a5f-0bea849e27d3 with http://127.0.0.1:8001
2025-10-11 20:41:32,523 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:32,523 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:32,524 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,524 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,525 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,525 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,525 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,526 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,526 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,526 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,526 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,712 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,712 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,713 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,713 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session d61c7e92-eee9-4559-b62c-96cfea00bc4e
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,716 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,717 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,717 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,717 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:32,720 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,720 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,720 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,721 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:32,723 - tools_gateway.services - DEBUG - Initialized session a5766244-c0d7-4627-829a-4de9dea3ce21 with http://127.0.0.1:8001
2025-10-11 20:41:32,725 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:32,725 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:32,726 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,726 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,727 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,727 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,727 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,728 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,728 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,728 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,728 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,906 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,906 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,906 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,907 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 0317640f-7ad7-47ae-9996-608b368bc697
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:32,911 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,911 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,911 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,911 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:32,915 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:32,915 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:32,915 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:32,915 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:32,917 - tools_gateway.services - DEBUG - Initialized session b22f28e9-f3bb-4676-ace9-8c6b2f6794cb with http://127.0.0.1:8001
2025-10-11 20:41:32,920 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:32,920 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:32,921 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:32,921 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,921 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,921 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,922 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,922 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,922 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,923 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:32,923 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:32,923 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:32,924 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:33,171 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,172 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,172 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,172 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 8294f94e-48b9-4f21-9274-f67b121139bd
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:33,175 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,176 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,176 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,176 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:33,180 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,181 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,181 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,181 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:33,183 - tools_gateway.services - DEBUG - Initialized session c4dce38e-39e3-48b2-89fe-7e1a1bf9c3a2 with http://127.0.0.1:8001
2025-10-11 20:41:33,185 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:33,186 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:33,186 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:33,186 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,186 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,186 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,187 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,187 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,187 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,188 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,188 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,189 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,189 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,189 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,189 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,189 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,189 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:33,667 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,667 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,668 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,668 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session 6cda0162-bbc3-4556-bd54-b892924242c1
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:33,672 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,673 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,673 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,673 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:33,676 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:33,677 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:33,677 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:33,677 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:33,679 - tools_gateway.services - DEBUG - Initialized session b6d3ef33-9c1d-4ab2-b4b0-165e29b43a27 with http://127.0.0.1:8001
2025-10-11 20:41:33,682 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:33,682 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:33,683 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,683 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,683 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,684 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,684 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,684 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:33,685 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:33,685 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:33,685 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,017 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,018 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,018 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,018 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session e97515b3-9a12-4d10-b478-6c4a8d810954
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,022 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,022 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,022 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,023 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:34,026 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,026 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,026 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,026 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:34,029 - tools_gateway.services - DEBUG - Initialized session 72808248-61c0-47f0-94d2-4710425d51ff with http://127.0.0.1:8001
2025-10-11 20:41:34,031 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:34,031 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:34,032 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,032 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,033 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,033 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,033 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,034 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,034 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,034 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,034 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,222 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,222 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,222 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,222 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session eba67087-eb25-4056-84e1-d211f6d5f5fa
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,226 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,226 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,226 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,226 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:34,230 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,230 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,230 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,230 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:34,233 - tools_gateway.services - DEBUG - Initialized session 47ec4657-486d-4215-a3aa-8d5bb53e3f2c with http://127.0.0.1:8001
2025-10-11 20:41:34,236 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:34,236 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:34,237 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,237 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,238 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,238 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,238 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,239 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,239 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,240 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,240 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,240 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,240 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,240 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,240 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,416 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,416 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,416 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,417 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by agentic-search with session c189c72b-a279-4d53-b6bd-d96217c32a6c
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:34,421 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,421 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,421 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,421 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:34,425 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:34,425 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:34,425 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:34,425 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:34,428 - tools_gateway.services - DEBUG - Initialized session adb75a61-8510-4333-8abf-4500a37f1ea7 with http://127.0.0.1:8001
2025-10-11 20:41:34,430 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:34,430 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:34,431 - tools_gateway.routers.mcp_router - INFO - tools/list: Filtering tools for user deepankar32@gmail.com with roles {'user'}
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,431 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,432 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'search_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,432 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'get_story' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,432 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,433 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'list_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:execute
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - ✅ Permission tool:execute FOUND in role user
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_fU6IZAPwaNLZbA1H, permission=tool:manage
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 User roles: ['user']
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 Checking role user: role_data=True
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - 🔍 Role user permissions: ['tool:execute', 'tool:view', 'server:view', 'config:view']
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - ⚠️  Permission tool:manage NOT in role user
2025-10-11 20:41:34,433 - tools_gateway.rbac - WARNING - ❌ Permission tool:manage NOT FOUND in any role for user user_fU6IZAPwaNLZbA1H
2025-10-11 20:41:34,433 - tools_gateway.rbac - INFO - ✅ RBAC: Tool 'count_stories' explicitly allowed for role 'user' on server 'mcp_127_0_0_1_8001'
2025-10-11 20:41:34,433 - tools_gateway.routers.mcp_router - INFO - tools/list: Returning 4 of 4 tools for user deepankar32@gmail.com
INFO:     127.0.0.1:59197 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:37,742 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:37,743 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:37,743 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:37,743 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session e25e6535-32c2-4233-99cc-76f5fe5a0c18
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:37,748 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:37,748 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:37,748 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:37,748 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:37,752 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:37,752 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:37,752 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:37,752 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:37,757 - tools_gateway.services - DEBUG - Initialized session 1a96fd4f-807e-4b50-a322-636c26210102 with http://127.0.0.1:8001
2025-10-11 20:41:37,760 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:37,761 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:37,761 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:38,404 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,404 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,404 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,404 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session 6525a51b-28a0-4381-a39f-d09069719dad
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:38,409 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,409 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,409 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,409 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:38,413 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,413 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,413 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,413 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:38,417 - tools_gateway.services - DEBUG - Initialized session 9ad33cea-e363-4df4-a77c-5e9c0db676c9 with http://127.0.0.1:8001
2025-10-11 20:41:38,421 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:38,422 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:38,422 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:38,605 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,605 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,605 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,606 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session e724d6da-bf02-45a7-9074-39947e6d7142
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:38,611 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,611 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,611 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,611 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:38,616 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:38,616 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:38,616 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:38,617 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:38,621 - tools_gateway.services - DEBUG - Initialized session f3255c03-7fac-4bc8-92c0-5e72a03ff562 with http://127.0.0.1:8001
2025-10-11 20:41:38,624 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:38,625 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:38,625 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:42,830 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:42,830 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:42,831 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:42,831 - tools_gateway.routers.mcp_router - INFO - MCP Toolbox Gateway initialized by mcp-portal-ui with session e9e82f03-9642-43ef-a0db-4e37a56de72e
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
2025-10-11 20:41:42,835 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:42,836 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:42,836 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:42,836 - tools_gateway.routers.mcp_router - INFO - Client initialization completed.
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 202 Accepted
2025-10-11 20:41:42,839 - tools_gateway.routers.mcp_router - INFO - POST endpoint - Extracted origin: http://localhost:8021
2025-10-11 20:41:42,839 - tools_gateway.mcp_models - DEBUG - Origin validation: hostname=localhost, allowed={'0.0.0.0', '127.0.0.1', 'localhost'}
2025-10-11 20:41:42,839 - tools_gateway.mcp_models - INFO - ✓ Origin allowed (whitelist): http://localhost:8021
2025-10-11 20:41:42,839 - tools_gateway.routers.mcp_router - INFO - tools/list: Fetching from discovery service.
2025-10-11 20:41:42,843 - tools_gateway.services - DEBUG - Initialized session 744c7588-0cae-48e9-afeb-17e1b5b61d5e with http://127.0.0.1:8001
2025-10-11 20:41:42,846 - tools_gateway.services - INFO - Successfully fetched 4 tools from http://127.0.0.1:8001 (JSON)
2025-10-11 20:41:42,847 - tools_gateway.services - INFO - Aggregated 4 tools from 1 servers
2025-10-11 20:41:42,847 - tools_gateway.routers.mcp_router - WARNING - tools/list: Anonymous access - returning all tools (consider requiring auth)
INFO:     127.0.0.1:59191 - "POST /mcp HTTP/1.1" 200 OK
INFO:     127.0.0.1:59191 - "GET /config HTTP/1.1" 200 OK
INFO:     127.0.0.1:59203 - "GET /health/servers HTTP/1.1" 200 OK
INFO:     127.0.0.1:59203 - "GET /auth/providers HTTP/1.1" 200 OK
2025-10-11 20:41:45,277 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=user:manage
2025-10-11 20:41:45,277 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:45,278 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:45,278 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting user:manage automatically
INFO:     127.0.0.1:59203 - "GET /admin/ad/config HTTP/1.1" 200 OK
2025-10-11 20:41:45,280 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=user:view
2025-10-11 20:41:45,280 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:45,280 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:45,280 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting user:view automatically
INFO:     127.0.0.1:59191 - "GET /admin/ad/group-mappings HTTP/1.1" 200 OK
2025-10-11 20:41:45,281 - tools_gateway.routers.admin_users_router - INFO - 🔍 /admin/users endpoint - Authorization header present: True
2025-10-11 20:41:45,281 - tools_gateway.routers.admin_users_router - INFO - 🔍 Token payload: {'sub': 'user_Mi68A0THzHhV4S9O', 'email': 'admin', 'name': 'Administrator', 'provider': 'local', 'exp': 1760269265, 'iat': 1760240465, 'type': 'access'}
2025-10-11 20:41:45,282 - tools_gateway.routers.admin_users_router - INFO - 🔍 User retrieved from email 'admin': True
2025-10-11 20:41:45,282 - tools_gateway.routers.admin_users_router - INFO - 🔍 User details: user_id=user_Mi68A0THzHhV4S9O, email=admin, roles={'admin'}
2025-10-11 20:41:45,282 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=user:view
2025-10-11 20:41:45,282 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:45,282 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:45,282 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting user:view automatically
2025-10-11 20:41:45,282 - tools_gateway.routers.admin_users_router - INFO - ✅ Permission check passed for user: user_Mi68A0THzHhV4S9O
INFO:     127.0.0.1:59206 - "GET /admin/users HTTP/1.1" 200 OK
2025-10-11 20:41:45,283 - tools_gateway.rbac - INFO - 🔍 has_permission check: user_id=user_Mi68A0THzHhV4S9O, permission=role:view
2025-10-11 20:41:45,283 - tools_gateway.rbac - INFO - 🔍 User data retrieved: True
2025-10-11 20:41:45,283 - tools_gateway.rbac - INFO - 🔍 User roles: ['admin']
2025-10-11 20:41:45,284 - tools_gateway.rbac - INFO - ✅ User user_Mi68A0THzHhV4S9O has 'admin' role - SUPERUSER - granting role:view automatically
INFO:     127.0.0.1:59207 - "GET /admin/roles HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-10-11 20:46:39,895 - tools_gateway.main - INFO - Tools Gateway shutting down...
2025-10-11 20:46:39,895 - tools_gateway.services - INFO - Stopped connection health monitoring
2025-10-11 20:46:39,897 - tools_gateway.services - INFO - aiohttp.ClientSession closed.
INFO:     Application shutdown complete.
INFO:     Finished server process [14872]
INFO:     Stopping reloader process [10632]
